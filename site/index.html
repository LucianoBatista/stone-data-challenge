
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.11">
    
    
      
        <title>Stone Data Challenge</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.8c5ef100.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.9647289d.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="green">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-challenge-stone-2022" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Stone Data Challenge" class="md-header__button md-logo" aria-label="Stone Data Challenge" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Stone Data Challenge
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Framework de Avaliação
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Stone Data Challenge" class="md-nav__button md-logo" aria-label="Stone Data Challenge" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Stone Data Challenge
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Framework de Avaliação
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        Framework de Avaliação
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#framework-de-avaliacao" class="md-nav__link">
    Framework de Avaliação
  </a>
  
    <nav class="md-nav" aria-label="Framework de Avaliação">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validacoes-iniciais" class="md-nav__link">
    Validações iniciais
  </a>
  
    <nav class="md-nav" aria-label="Validações iniciais">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-portfolio_clientes" class="md-nav__link">
    1. portfolio_clientes
  </a>
  
    <nav class="md-nav" aria-label="1. portfolio_clientes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#distribuicao-de-tipo-da-empresa" class="md-nav__link">
    Distribuição de Tipo da Empresa
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distribuicao-dos-estados" class="md-nav__link">
    Distribuição dos Estados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distribuicao-dos-segmentos-e-subsegmentos" class="md-nav__link">
    Distribuição dos Segmentos e Subsegmentos
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-portfolio_tpv" class="md-nav__link">
    2. portfolio_tpv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-portfolio_comunicados" class="md-nav__link">
    3. portfolio_comunicados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-portfolio_geral" class="md-nav__link">
    4. portfolio_geral
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fluxo-de-etapas-realizadas" class="md-nav__link">
    Fluxo de etapas realizadas
  </a>
  
    <nav class="md-nav" aria-label="Fluxo de etapas realizadas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-merge-e-criacao-de-features" class="md-nav__link">
    1. Merge e Criação de Features
  </a>
  
    <nav class="md-nav" aria-label="1. Merge e Criação de Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geral-comunicados" class="md-nav__link">
    Geral + Comunicados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quebra-entre-o-dsp-e-o-dspp" class="md-nav__link">
    Quebra entre o DSP e o DSPP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criacao-de-features-de-dsp-e-dspp" class="md-nav__link">
    Criação de features de DSP e DSPP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entregou-nao-entregou-leu" class="md-nav__link">
    Entregou? Não Entregou? Leu?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#valor-devedor-esperado" class="md-nav__link">
    Valor devedor esperado
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trazendo-dados-cadastrais" class="md-nav__link">
    Trazendo dados cadastrais
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tpv" class="md-nav__link">
    + TPV
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-analise-exploratoria-dataset-final" class="md-nav__link">
    2. Análise Exploratória (Dataset final)
  </a>
  
    <nav class="md-nav" aria-label="2. Análise Exploratória (Dataset final)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsp-e-dspp-pelo-segmento-e-subsegmento" class="md-nav__link">
    DSP e DSPP pelo Segmento e Subsegmento
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-clusterizacao" class="md-nav__link">
    3. Clusterização
  </a>
  
    <nav class="md-nav" aria-label="3. Clusterização">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsp" class="md-nav__link">
    DSP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dspp" class="md-nav__link">
    DSPP
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-dashboarding" class="md-nav__link">
    3. Dashboarding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusoes-e-insights" class="md-nav__link">
    Conclusões e Insights
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="data_dict/" class="md-nav__link">
        Dicionário de Dados
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#framework-de-avaliacao" class="md-nav__link">
    Framework de Avaliação
  </a>
  
    <nav class="md-nav" aria-label="Framework de Avaliação">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validacoes-iniciais" class="md-nav__link">
    Validações iniciais
  </a>
  
    <nav class="md-nav" aria-label="Validações iniciais">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-portfolio_clientes" class="md-nav__link">
    1. portfolio_clientes
  </a>
  
    <nav class="md-nav" aria-label="1. portfolio_clientes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#distribuicao-de-tipo-da-empresa" class="md-nav__link">
    Distribuição de Tipo da Empresa
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distribuicao-dos-estados" class="md-nav__link">
    Distribuição dos Estados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distribuicao-dos-segmentos-e-subsegmentos" class="md-nav__link">
    Distribuição dos Segmentos e Subsegmentos
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-portfolio_tpv" class="md-nav__link">
    2. portfolio_tpv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-portfolio_comunicados" class="md-nav__link">
    3. portfolio_comunicados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-portfolio_geral" class="md-nav__link">
    4. portfolio_geral
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fluxo-de-etapas-realizadas" class="md-nav__link">
    Fluxo de etapas realizadas
  </a>
  
    <nav class="md-nav" aria-label="Fluxo de etapas realizadas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-merge-e-criacao-de-features" class="md-nav__link">
    1. Merge e Criação de Features
  </a>
  
    <nav class="md-nav" aria-label="1. Merge e Criação de Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geral-comunicados" class="md-nav__link">
    Geral + Comunicados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quebra-entre-o-dsp-e-o-dspp" class="md-nav__link">
    Quebra entre o DSP e o DSPP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criacao-de-features-de-dsp-e-dspp" class="md-nav__link">
    Criação de features de DSP e DSPP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entregou-nao-entregou-leu" class="md-nav__link">
    Entregou? Não Entregou? Leu?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#valor-devedor-esperado" class="md-nav__link">
    Valor devedor esperado
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trazendo-dados-cadastrais" class="md-nav__link">
    Trazendo dados cadastrais
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tpv" class="md-nav__link">
    + TPV
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-analise-exploratoria-dataset-final" class="md-nav__link">
    2. Análise Exploratória (Dataset final)
  </a>
  
    <nav class="md-nav" aria-label="2. Análise Exploratória (Dataset final)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsp-e-dspp-pelo-segmento-e-subsegmento" class="md-nav__link">
    DSP e DSPP pelo Segmento e Subsegmento
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-clusterizacao" class="md-nav__link">
    3. Clusterização
  </a>
  
    <nav class="md-nav" aria-label="3. Clusterização">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dsp" class="md-nav__link">
    DSP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dspp" class="md-nav__link">
    DSPP
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-dashboarding" class="md-nav__link">
    3. Dashboarding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusoes-e-insights" class="md-nav__link">
    Conclusões e Insights
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="data-challenge-stone-2022">Data Challenge Stone 2022</h1>
<p><img alt="header" src="imgs/header-challenge.png" /></p>
<p>O objetivo dessa página é servir de documnetação de todo o processo de análise realizado na base fornecida pela Stone. Aqui será registrado o Framework de Avaliação.</p>
<p>Para mais informações sobre o desafio acesse: <a href="https://lp.stone.com.br/stone-data-challenge/">LINK</a>.</p>
<h2 id="framework-de-avaliacao">Framework de Avaliação</h2>
<p>A minha análise sobre os dados da Stone segue <em>duas grandes etapas</em>. Primeiramente foi realizado uma análise mais descritiva dos dados, com o objetivo de conhecer detalhes dos dados e possíveis inconsistências. E posteriormente, uma análise mais direcionada para resolução do problema.</p>
<p>Nas <strong>validações iniciais</strong> será registrado a etapa descritiva, e em <strong>fluxo de etapas realizadas</strong> será registrado os passos para chegar na melhor curva de acionamento do cliente.</p>
<h3 id="validacoes-iniciais">Validações iniciais</h3>
<p>Como dito anteriormente, nesta etapa foi realizada uma análise descritiva das bases que estão disponíveis para trabalhar. Nesse caso nós tempos:</p>
<ul>
<li><code>portfolio_clientes</code></li>
<li><code>portfolio_comunicados</code></li>
<li><code>portfolio_geral</code></li>
<li><code>portfolio_tpv</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># libs</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">src.make_plot</span> <span class="kn">import</span> <span class="n">plot</span>

<span class="c1"># matplotlib configs</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>

<span class="c1"># data</span>
<span class="n">clients</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/portfolio_clientes.csv&quot;</span><span class="p">)</span>
<span class="n">tpv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/portfolio_tpv.csv&quot;</span><span class="p">)</span>
<span class="n">comunicados</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/portfolio_comunicados.csv&quot;</span><span class="p">)</span>
<span class="n">geral</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/portfolio_geral.csv&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="1-portfolio_clientes">1. portfolio_clientes</h4>
<p>Aqui encontramos todas as informações relacionadas aos dados cadastrais dos clientes que contratam empréstimos, assim como dados geográficos e segmentos do negócio.</p>
<p>A base deveria possuir como registro único, a coluna de <code>nr_documento</code>, porém foi visto que existem registros duplicados. Devido a essa inconsistência, os contratos relacionadas aos <code>nr_documento</code> duplicados não serão considerados.</p>
<p>Vamos então calcular o total de clientes registrados:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># total de clientes</span>
<span class="n">clients_wo_duplicate</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;nr_documento&quot;</span><span class="p">])</span>
<span class="n">clients_wo_duplicate</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">(</span><span class="m">14265</span>, <span class="m">6</span><span class="o">)</span>
</code></pre></div>
<p>Dessa forma, possuímos um total de <strong>14.265 clientes</strong> na base. Esse valor não reflete diretamente na quantidade de contrato já que cada cliente pode possuir mais de um contrato. Apenas a nível já realizarmos um comparativo, puxamos também o número de contratos registrados na base:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># total de clientes</span>
<span class="n">geral</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;contrato_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">(</span><span class="m">14756</span>, <span class="m">22</span><span class="o">)</span>
</code></pre></div>
<p>Trazendo a informação da tabela <code>portfolio_geral</code> vemos que existe um número levemente maior, <strong>14.756 contratos</strong>, registrados.</p>
<p>Essa base é composta de mais algumas variáveis categóricas, e saber como as mesmas estão distribuídas pode nos trazer bons insights para análises futuras mais complexas.</p>
<h5 id="distribuicao-de-tipo-da-empresa">Distribuição de Tipo da Empresa</h5>
<div class="highlight"><pre><span></span><code><span class="c1"># getthering the data to plot</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="s2">&quot;tipo_empresa&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;tipo_empresa&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># this function is part of the code on src directory</span>
<span class="n">plot</span><span class="o">.</span><span class="n">make_beautiful_bar_plots</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="s2">&quot;Distribuição do Tipo de Empresa&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Tipos de Empresas&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Quantidade de Clientes em cada Empresa&quot;</span><span class="p">,</span>
    <span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>
<p><img alt="dist-tipo-empresa" src="imgs/dist-tipo-empresa.png" /></p>
<p>A maioria dos clientes estão cadastrados como <strong>Pessoa Jurídica</strong>, e bem pouco como <strong>Pessoal Física</strong>.</p>
<h5 id="distribuicao-dos-estados">Distribuição dos Estados</h5>
<div class="highlight"><pre><span></span><code><span class="n">counts</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="s2">&quot;estado&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;estado&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># this function is part of the code on src directory</span>
<span class="n">plot</span><span class="o">.</span><span class="n">make_beautiful_bar_plots</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="s2">&quot;Distribuição de quantidade de clientes em cada Estado.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Estados brasileiros&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Quantidade de clientes em cada Estado&quot;</span><span class="p">,</span>
    <span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>
<p><img alt="dist-estados" src="imgs/dist-estados.png" /></p>
<p>Aqui vemos uma grande maioria dos clientes pertecentes ao Estado de <strong>São Paulo</strong>, seguido pelo <strong>Rio de Janeiro</strong>. A diferença dentre os outros Estados vai decaindo gradualmente.</p>
<h5 id="distribuicao-dos-segmentos-e-subsegmentos">Distribuição dos Segmentos e Subsegmentos</h5>
<div class="highlight"><pre><span></span><code><span class="n">counts</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="s2">&quot;segmento&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;segmento&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># this function is part of the code on src directory</span>
<span class="n">plot</span><span class="o">.</span><span class="n">make_beautiful_bar_plots</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="s2">&quot;Distribuição de quantidade de clientes em cada segmento.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Segmentos&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Quantidade de clientes em cada segmento&quot;</span><span class="p">,</span>
    <span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>
<p><img alt="dist-segmentos" src="imgs/dist-segmentos.png" /></p>
<p>Quando olhamos para os segmentos, é possível ver uma predominância do setor de <em>Alimentação</em>, seguido de <em>Verejo</em>, <em>Bens Duráveis</em>, <em>Serviços</em> e <em>Supermercado/Farmácia</em>, com uma minoria em outras 4 categorias.</p>
<div class="highlight"><pre><span></span><code><span class="n">counts</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="s2">&quot;subsegmento&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;subsegmento&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># this function is part of the code on src directory</span>
<span class="n">plot</span><span class="o">.</span><span class="n">make_beautiful_bar_plots</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="s2">&quot;Distribuição de quantidade de clientes em cada subsegmento.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Subsegmentos&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Quantidade de clientes em cada subsegmento&quot;</span><span class="p">,</span>
    <span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>
<p><img alt="dist-subsegmentos" src="imgs/dist-subsegmentos.png" /></p>
<p>Já nos Subsegmentos, temos duas grandes representatividades, Alimentação Rápida e Lojas Diversas. De <em>Outros</em> em diante, a frequência de clientes vai caindo gradualmente.</p>
<p>Um ponto interessante a se observar é que a maior quantidade de clientes está relacionada a <em>Alimentação</em>, seja diretamente, como indiretamente dentro dos top 5, como: Bares e Restaurantes e Supermercados.</p>
<p>Interessante a se notar também é que temos a presença de um subsegmento chamado <code>None</code> como uma string válida, quando na verdade categoriza um missing value e não um subsegmento de fato.</p>
<h4 id="2-portfolio_tpv">2. portfolio_tpv</h4>
<p>Essa tabela trás toda a informação de <em>Total Paid Value</em> que representa o valor transacionado no dia por cada um dos clientes pela maquininha Stone.</p>
<p>Aqui buscou-se também pela contagem de quantos <code>nr_documento</code> existem na tabela, chegando no valor de <strong>14.259 clientes</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="n">tpv</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;nr_documento&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">(</span><span class="m">14259</span>, <span class="m">4</span><span class="o">)</span>
</code></pre></div>
<p>Veja que aqui nós temos uma divergência em relação à quantidade de <code>nr_documento</code> presente na tabela <code>portfolio_geral</code>. Um total de 6 clientes não possuem registro de TPV, porém, quando analisados na <code>portfolio_geral</code> vemos que os mesmos possuem valor de pagamento realizado, caracterizados pela presença de média.</p>
<div class="highlight"><pre><span></span><code><span class="n">nr_documento_tpv</span> <span class="o">=</span> <span class="n">tpv</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;nr_documento&quot;</span><span class="p">)[</span><span class="s2">&quot;nr_documento&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">geral_for_not_tpv</span> <span class="o">=</span> <span class="n">geral</span><span class="p">[</span><span class="o">~</span><span class="n">geral</span><span class="p">[</span><span class="s2">&quot;nr_documento&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nr_documento_tpv</span><span class="p">)]</span>
<span class="n">geral_for_not_tpv</span><span class="p">[[</span><span class="s2">&quot;vlr_desembolsado&quot;</span><span class="p">,</span> <span class="s2">&quot;vlr_pgto_realizado&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">stats</th>
<th align="center">vlr_desembolsado</th>
<th align="center">vlr_pgto_realizado</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">count</td>
<td align="center">3938.00</td>
<td align="center">3938.00</td>
</tr>
<tr>
<td align="center">mean</td>
<td align="center">11854.92</td>
<td align="center">11.86</td>
</tr>
<tr>
<td align="center">std</td>
<td align="center">7246.29</td>
<td align="center">176.45</td>
</tr>
<tr>
<td align="center">min</td>
<td align="center">384.75</td>
<td align="center">0.00</td>
</tr>
<tr>
<td align="center">25%</td>
<td align="center">3078.00</td>
<td align="center">0.00</td>
</tr>
<tr>
<td align="center">50%</td>
<td align="center">17100.00</td>
<td align="center">0.00</td>
</tr>
<tr>
<td align="center">75%</td>
<td align="center">17100.00</td>
<td align="center">0.00</td>
</tr>
<tr>
<td align="center">max</td>
<td align="center">20520.00</td>
<td align="center">5969.64</td>
</tr>
</tbody>
</table>
<p>Olhando um pouco mais no detalhe, é possível ver que alguns dos clientes de fato não tiveram nenhum pagamento realizado, o que justifica o mesmo não possuir registro na tabela <code>portfolio_tpv</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">geral_for_not_tpv</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;nr_documento&quot;</span><span class="p">])[</span><span class="s2">&quot;vlr_pgto_realizado&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;mean&quot;</span><span class="p">])</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">nr_documento</th>
<th align="center">mean</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0a6b34a6b108015777d83b1023d43342</td>
<td align="center">23.359794</td>
</tr>
<tr>
<td align="center">1eb088b95b56970c880030922dce1c85</td>
<td align="center">17.530547</td>
</tr>
<tr>
<td align="center">69116fe5b82f759fd2f295f1daa92ecf</td>
<td align="center">0.000000</td>
</tr>
<tr>
<td align="center">6ef839f0201c6295072e45a95eb34466</td>
<td align="center">10.529941</td>
</tr>
<tr>
<td align="center">e6addfdeb74a038bb5f7149c7cfb1290</td>
<td align="center">17.557847</td>
</tr>
<tr>
<td align="center">ec55907309c0e6195675cb786f7d7242</td>
<td align="center">0.000000</td>
</tr>
</tbody>
</table>
<p>Analisar o TPV como um todo não é muito conclusivo, temos valores muito dispersos de valor transacionado diariamente, assim como de máximos e mínimos.</p>
<div class="highlight"><pre><span></span><code><span class="n">tpv</span><span class="p">[[</span><span class="s2">&quot;qtd_transacoes&quot;</span><span class="p">,</span> <span class="s2">&quot;vlr_tpv&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">))</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">stats</th>
<th align="center">dt_transacao</th>
<th align="center">qtd_transacoes</th>
<th align="center">vlr_tpv</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">count</td>
<td align="center">4408597.00</td>
<td align="center">4408597.00</td>
<td align="center">4408597.00</td>
</tr>
<tr>
<td align="center">mean</td>
<td align="center">20204274.56</td>
<td align="center">15.91</td>
<td align="center">887.50</td>
</tr>
<tr>
<td align="center">std</td>
<td align="center">4656.32</td>
<td align="center">26.15</td>
<td align="center">1664.21</td>
</tr>
<tr>
<td align="center">min</td>
<td align="center">20200101.00</td>
<td align="center">-2.00</td>
<td align="center">-125000.00</td>
</tr>
<tr>
<td align="center">25%</td>
<td align="center">20200624.00</td>
<td align="center">3.00</td>
<td align="center">175.00</td>
</tr>
<tr>
<td align="center">50%</td>
<td align="center">20201030.00</td>
<td align="center">7.00</td>
<td align="center">430.00</td>
</tr>
<tr>
<td align="center">75%</td>
<td align="center">20210226.00</td>
<td align="center">18.00</td>
<td align="center">978.00</td>
</tr>
<tr>
<td align="center">max</td>
<td align="center">20210630.00</td>
<td align="center">1245.00</td>
<td align="center">176880.93</td>
</tr>
</tbody>
</table>
<p>Portanto, como temos os dados cadastrais dos clientes, é mais interessante levar isso em consideração na hora fazer a análise.</p>
<p>Vamos primeiramente juntar as bases:</p>
<div class="highlight"><pre><span></span><code><span class="n">tpv_merged</span> <span class="o">=</span> <span class="n">tpv</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="n">clients</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;nr_documento&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Analisando primeiramente o TPV para segmento e subsegmento, temos:</p>
<div class="highlight"><pre><span></span><code><span class="n">tpv_sum_segment</span> <span class="o">=</span> <span class="n">tpv_merged</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;segmento&quot;</span><span class="p">])[</span><span class="s2">&quot;vlr_tpv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;sum&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">tpv_sum_segment</span><span class="p">[</span><span class="s2">&quot;prop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tpv_sum_segment</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tpv_sum_segment</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">tpv_sum_subsegment</span> <span class="o">=</span> <span class="n">tpv_merged</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;subsegmento&quot;</span><span class="p">])[</span><span class="s2">&quot;vlr_tpv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;sum&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">tpv_sum_subsegment</span><span class="p">[</span><span class="s2">&quot;prop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tpv_sum_subsegment</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tpv_sum_subsegment</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">tpv_sum_segment</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;prop&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">segmento</th>
<th align="center">sum</th>
<th align="center">prop</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Alimentação</td>
<td align="center">1.473060e+09</td>
<td align="center">0.372553</td>
</tr>
<tr>
<td align="center">Bens duráveis</td>
<td align="center">7.342777e+08</td>
<td align="center">0.185707</td>
</tr>
<tr>
<td align="center">Varejo</td>
<td align="center">5.917481e+08</td>
<td align="center">0.149660</td>
</tr>
<tr>
<td align="center">Supermercado/Farmácia</td>
<td align="center">4.799287e+08</td>
<td align="center">0.121379</td>
</tr>
<tr>
<td align="center">Serviços</td>
<td align="center">4.409396e+08</td>
<td align="center">0.111518</td>
</tr>
<tr>
<td align="center">Posto</td>
<td align="center">8.120651e+07</td>
<td align="center">0.020538</td>
</tr>
<tr>
<td align="center">Serviços recorrentes</td>
<td align="center">6.621661e+07</td>
<td align="center">0.016747</td>
</tr>
<tr>
<td align="center">Viagens e entretenimento</td>
<td align="center">4.964331e+07</td>
<td align="center">0.012555</td>
</tr>
<tr>
<td align="center">Outros</td>
<td align="center">3.694166e+07</td>
<td align="center">0.009343</td>
</tr>
</tbody>
</table>
<p>Aqui vemos que a ordem muda um pouco, onde <strong>Varejo perde posição para Bens Duráveis</strong> e <strong>Serviços para Supermercado/Farmácia</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">tpv_sum_subsegment</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;prop&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">subsegmento</th>
<th align="center">sum</th>
<th align="center">prop</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Alimentação Rápida</td>
<td align="center">7.782735e+08</td>
<td align="center">0.196834</td>
</tr>
<tr>
<td align="center">Lojas Diversas</td>
<td align="center">6.846034e+08</td>
<td align="center">0.173144</td>
</tr>
<tr>
<td align="center">Supermercados</td>
<td align="center">4.372940e+08</td>
<td align="center">0.110596</td>
</tr>
<tr>
<td align="center">Bares e Restaurantes</td>
<td align="center">3.662225e+08</td>
<td align="center">0.092622</td>
</tr>
<tr>
<td align="center">Outros</td>
<td align="center">3.469090e+08</td>
<td align="center">0.087737</td>
</tr>
<tr>
<td align="center">Automotivo</td>
<td align="center">2.711954e+08</td>
<td align="center">0.068588</td>
</tr>
<tr>
<td align="center">Saúde</td>
<td align="center">2.537558e+08</td>
<td align="center">0.064178</td>
</tr>
<tr>
<td align="center">Material de Construção</td>
<td align="center">2.178250e+08</td>
<td align="center">0.055090</td>
</tr>
<tr>
<td align="center">Vestuário</td>
<td align="center">2.070685e+08</td>
<td align="center">0.052370</td>
</tr>
<tr>
<td align="center">Atacadistas Gerais</td>
<td align="center">1.396476e+08</td>
<td align="center">0.035318</td>
</tr>
<tr>
<td align="center">Postos de Gasolina</td>
<td align="center">8.112604e+07</td>
<td align="center">0.020518</td>
</tr>
<tr>
<td align="center">Educação</td>
<td align="center">4.507371e+07</td>
<td align="center">0.011400</td>
</tr>
<tr>
<td align="center">None</td>
<td align="center">4.076986e+07</td>
<td align="center">0.010311</td>
</tr>
<tr>
<td align="center">Lazer &amp; Turismo</td>
<td align="center">3.600002e+07</td>
<td align="center">0.009105</td>
</tr>
<tr>
<td align="center">Atacadista de Alimento</td>
<td align="center">2.495160e+07</td>
<td align="center">0.006311</td>
</tr>
<tr>
<td align="center">Academias</td>
<td align="center">2.324615e+07</td>
<td align="center">0.005879</td>
</tr>
</tbody>
</table>
<p>Em relação ao subsegmento, vemos que houve uma troca de posição entre <strong>Supermercados e Outros</strong>.</p>
<p>Com essas duas bases podemos buscar por sasonalidade nos dados e melhor compreender como cada negócio oscila ao passar do tempo. Para isso, iremos utilizar uma visão de heatmap variando na horizontal o meses do ano, e na vertical todos os nossos Estados, e o valor mapeado no heatmap é o somatório do TPV naquele específico grupo.</p>
<p>Vamos criar as variáveis temporais que iremos precisar e agroupar os dados que serão utilizados para o heatmap:</p>
<div class="highlight"><pre><span></span><code><span class="n">tpv_merged</span><span class="p">[</span><span class="s2">&quot;dt_transacao&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">tpv_merged</span><span class="p">[</span><span class="s2">&quot;dt_transacao&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">tpv_merged</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tpv_merged</span><span class="p">[</span><span class="s2">&quot;dt_transacao&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
<span class="n">tpv_merged</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tpv_merged</span><span class="p">[</span><span class="s2">&quot;dt_transacao&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

<span class="c1"># grouping</span>
<span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">tpv_merged</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;segmento&quot;</span><span class="p">,</span> <span class="s2">&quot;estado&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">])[</span><span class="s2">&quot;vlr_tpv&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;sum&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># labels for the plot</span>
<span class="n">segmentos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;segmento&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">monhts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>

<span class="c1"># this code will generate all heatmaps</span>
<span class="k">for</span> <span class="n">segmento</span> <span class="ow">in</span> <span class="n">segmentos</span><span class="p">:</span>
    <span class="n">df_segmento</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2020</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;segmento&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">segmento</span><span class="p">)]</span>
    <span class="n">estados</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_segmento</span><span class="p">[</span><span class="s2">&quot;estado&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

    <span class="n">df_heatmap</span> <span class="o">=</span> <span class="n">df_segmento</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;segmento&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">values</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;estado&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span>
    <span class="p">)</span>


    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="n">im</span><span class="p">,</span> <span class="n">cbar</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">df_heatmap</span><span class="p">,</span> <span class="n">estados</span><span class="p">,</span> <span class="n">monhts</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlGn&quot;</span><span class="p">,</span> <span class="n">cbarlabel</span><span class="o">=</span><span class="s2">&quot;Total TPV&quot;</span><span class="p">)</span>

    <span class="c1"># Number of accent colors in the color scheme</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">segmento</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p>Como temos diferentes tipos de segmentos, achei mais prudente trazer apenas os Top 3 segmentos de maior TPV para interpretarmos os heatmaps.</p>
<p><img alt="img-alimentacao-over-time" src="imgs/alimentacao-over-time.png" /></p>
<p><img alt="img-bens-duraveis-over-time" src="imgs/bens-duraveis-over-time.png" /></p>
<p><img alt="img-varejo-over-time" src="imgs/varejo-over-time.png" /></p>
<p>O que vemos aqui é que o valor do total de TPV transacionado ao longo do ano de 2020 foram bem semelhantes, com predomínio de São Paulo e Rio de Janeiro (por serem os Estados com mais clientes) e a predominância também do período do segundo trimestre ter sido um período de baixa e que provavelmente deve ter impactado o valor pago nas maquininhas.</p>
<p>O Subsegmento também demonstrou comportamento semelhante ao considerar os Top 3 pelo valor do TPV. A única diferença é que acabamos tendo uma variabilidade maior entre os Estados e ao longo do ano para subsegmentos menores, como <strong>Academia e Atacadista de Alimento</strong>.</p>
<p><img alt="img-academia-over-time" src="imgs/academia-over-time.png" /></p>
<p><img alt="img-atacadista-over-time" src="imgs/atcadista-alimento-over-time.png" /></p>
<p>Acredito que tal comportamento deveria ser levado em consideração ao estabelecer uma régua de acionamento. Pois até mesmo, as cidades dentro de Estados maiores, como São Paulo e Rio de Janeiro também podem apresentar realidades diferentes por Segmentos e Subsegmentos.</p>
<h4 id="3-portfolio_comunicados">3. portfolio_comunicados</h4>
<p>Essa tabela possui todo o dado de quem foi acionado no seu histórico de empréstimo de linha de crédito. Ao longo desse período, 403.704 acionamentos foram realizados, onde 47.35% sofreram algum problema e acabaram por não serem entregues, 34% foram de fato entregues, 17.6 foram lidas e 0.08 foram respondidas.</p>
<div class="highlight"><pre><span></span><code><span class="n">comunicados</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>Também observou-se que os acionamentos são realizados por dois canais, <strong>mensagens diretas e email</strong>. Porém, ao analisar os subtotais dentro de cada status, vemos que não existe preferência entre os tipos canais utilizados</p>
<div class="highlight"><pre><span></span><code><span class="n">comunicados</span><span class="o">.</span><span class="n">value_counts</span><span class="p">([</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;tipo_acao&quot;</span><span class="p">],</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">status</th>
<th align="center">tipo_acao</th>
<th align="center">prop</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">NAO ENTREGUE</td>
<td align="center">HSM</td>
<td align="center">0.236836</td>
</tr>
<tr>
<td align="center">NAO ENTREGUE</td>
<td align="center">EMAIL</td>
<td align="center">0.236754</td>
</tr>
<tr>
<td align="center">ENTREGUE</td>
<td align="center">HSM</td>
<td align="center">0.171046</td>
</tr>
<tr>
<td align="center">ENTREGUE</td>
<td align="center">EMAIL</td>
<td align="center">0.170637</td>
</tr>
<tr>
<td align="center">LIDO</td>
<td align="center">HSM</td>
<td align="center"><strong>0.088706</strong></td>
</tr>
<tr>
<td align="center">LIDO</td>
<td align="center">EMAIL</td>
<td align="center"><strong>0.088091</strong></td>
</tr>
<tr>
<td align="center">RESPONDIDO</td>
<td align="center">EMAIL</td>
<td align="center">0.004518</td>
</tr>
<tr>
<td align="center">RESPONDIDO</td>
<td align="center">HSM</td>
<td align="center">0.003413</td>
</tr>
</tbody>
</table>
<p>Todos esses acionamentos foram realizados para um total de <strong>12.202 contratos</strong>, o que representa aproximadamente <strong>83% da base</strong>. Um número bastante alto de clientes que apresentaram algum tipo de inadiplência.</p>
<p>E por fim, pelo gráfico abaixo, podemos ver que <strong>52%</strong> das campanhas realizadas foram de <em>observação</em>, seguido de parcelamento e boleto quitado.</p>
<div class="highlight"><pre><span></span><code><span class="n">counts</span> <span class="o">=</span> <span class="n">comunicados</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="s2">&quot;acao&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;acao&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">plot</span><span class="o">.</span><span class="n">make_beautiful_bar_plots</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="s2">&quot;Distribuição do Tipo de Ação&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Tipos de Ações&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Quantidade de Ações realizadas&quot;</span><span class="p">,</span>
    <span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>
<p><img alt="img-tipo-acao" src="imgs/tipo-acao.png" /></p>
<h4 id="4-portfolio_geral">4. portfolio_geral</h4>
<p>Essa é a maior tabela que temos e a mesma tem todo o histórico de cada um dos mais de 12k de contratos registrados. Com essa tabela farei algumas sumarizações e criação de métricas envolvendo o dsp (Dias Corridos sem Pagamento) e o dspp (Dias Corridos sem Pagamento do Principal), que serão descritas na próxima do framework de avaliação.</p>
<p>Essa tabela, em conjunto com dados de todas as outras, irá nos auxiliar a responder o nosso problema principal: <em>Qual é a quantidade ideal de vezes que acionamos um cliente?</em>.</p>
<h3 id="fluxo-de-etapas-realizadas">Fluxo de etapas realizadas</h3>
<p>Tudo que foi feito até o momento pode ser encontrado no notebook <code>describe.ipynb</code>. Daqui pra frente iremos consumir dos notebooks <code>final_composition.ipynb</code> e <code>analysis.ipynb</code>. Onde o primeiro é o responsável por juntar as tabelas e o segundo possui o desenrolar da análise.</p>
<p>Como output, o notebook <code>final_composition.ipynb</code> irá nos fornecer um dataset que permitirá uma análise mais robusta e a entender a melhor curva de acionamento ao cliente.</p>
<h4 id="1-merge-e-criacao-de-features">1. Merge e Criação de Features</h4>
<p>Primeiramente, vamos precisar trazer todos as nossas tabelas e as libs que serão utilizadas.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">src.feature_engineering</span> <span class="kn">import</span> <span class="n">features</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">clients</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/portfolio_clientes.csv&quot;</span><span class="p">)</span>
<span class="n">tpv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/portfolio_tpv.csv&quot;</span><span class="p">)</span>
<span class="n">comunicados</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/portfolio_comunicados.csv&quot;</span><span class="p">)</span>
<span class="n">geral</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/portfolio_geral.csv&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Aqui vamos utilizar um módulo de feature engineering que criei para nos auxiliar na criação das features de uma forma mais modular e clean. Detalhes sobre essas etapas específicas de feature engineering vão ser retratadas em uma página bônus da documentação.</p>
<h5 id="geral-comunicados">Geral + Comunicados</h5>
<p>Como visto anteriormente, nem todos os clientes receberam acionamento, por isso, vamos precisar filtrar a base para contemplar apenas os casos que possuem acionamento.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># contratos únicos na tabela de comunicados</span>
<span class="n">unique_contratos</span> <span class="o">=</span> <span class="n">comunicados</span><span class="p">[</span><span class="s2">&quot;contrato_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="c1"># filtrando por esses contratos</span>
<span class="n">geral_comunicados</span> <span class="o">=</span> <span class="n">geral</span><span class="p">[</span><span class="n">geral</span><span class="p">[</span><span class="s2">&quot;contrato_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">unique_contratos</span><span class="p">)]</span>

<span class="c1"># como cada contrato possui mais de um acionamento, para evitar duplicidades</span>
<span class="c1"># vamos agregar em uma lista os duplicados.</span>
<span class="n">comunicados_grouped</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">comunicados</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;contrato_id&quot;</span><span class="p">,</span> <span class="s2">&quot;dt_ref_portfolio&quot;</span><span class="p">,</span> <span class="s2">&quot;data_acao&quot;</span><span class="p">])[</span>
        <span class="p">[</span><span class="s2">&quot;tipo_acao&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;acao&quot;</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">geral_comunicados_grouped</span> <span class="o">=</span> <span class="n">geral_comunicados</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">right</span><span class="o">=</span><span class="n">comunicados_grouped</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;contrato_id&quot;</span><span class="p">,</span> <span class="s2">&quot;dt_ref_portfolio&quot;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>Veja que estamos utilizando um <code>left-join</code> aqui por que a tabela <code>portfolio_geral</code> possui valores diários, e nem todos os dias ocorreram acionamentos, porém, ter essa informação é muiti útil para as próximas etapas.</p>
<p>Por fim, vamos realizar um sort nos dados, para garantir que o dsp e o dspp estarão na ordem correta mais pra frente, quando formos criar as novas features.</p>
<div class="highlight"><pre><span></span><code><span class="n">geral_and_comunicados_sorted_df</span> <span class="o">=</span> <span class="n">geral_comunicados_grouped</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;contrato_id&quot;</span><span class="p">,</span> <span class="s2">&quot;dt_ref_portfolio&quot;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<h5 id="quebra-entre-o-dsp-e-o-dspp">Quebra entre o DSP e o DSPP</h5>
<p>Detalhes nesse tópico podem ser investigados no arquivo <code>final_composition_v2.ipynb</code>, mas o objetivo aqui é desconsiderar (antes de realizar o cálculo), os acionamentos que acabaram não sendo entregues.</p>
<p>Nesse procedimento, foram gerados pesos para os tipos de acionamentos:</p>
<ul>
<li>Não entregue = 0</li>
<li>Entregue = 1</li>
<li>Lido = 2</li>
<li>Respondido = 3</li>
</ul>
<p>Isso nos possibilitou também a criar uma nova feature, que oscila entre 1 e 3. Quanto mais próximo de 3, mais engajado o cliente está em ler e/ou responder aos acionamentos.</p>
<h5 id="criacao-de-features-de-dsp-e-dspp">Criação de features de DSP e DSPP</h5>
<p>Aqui está uma <strong>etapa muito importante</strong> do fluxo da análise dos dados. Uma informação que precisamos ter para prosseguir com a análise é <strong>se os acionamentos foram efetivos</strong> para retornar o cliente para a utilização da maquininha da Stone.</p>
<p>Tal feature aqui vai ser entendidad da seguinte forma:</p>
<blockquote>
<p>Se o cliente retornou sua utilização da maquininha dentro de período que antecede o acionamento subsequente, configura SUCESSO.</p>
</blockquote>
<p>Com isso em mente, criou-se o módulo de <code>feature_engineering</code>, onde parte das funções contemplam exatamente esse cálculo. Os dois blocos de código abaixo apresentam como as funções são aplicadas por intermédio do <code>pandas</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># para o dsp</span>
<span class="n">contrato_dsp_features</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">geral_and_comunicados_sorted_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;contrato_id&quot;</span><span class="p">])[</span><span class="s2">&quot;dsp&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">features</span><span class="o">.</span><span class="n">total_success_dsp5</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">total_success_dsp10</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">total_success_dsp15</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">total_success_dsp30</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">total_success_dsp60</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">total_success_dsp90</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">prop_success_dsp5</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">prop_success_dsp10</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">prop_success_dsp15</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">prop_success_dsp30</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">prop_success_dsp60</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">prop_success_dsp90</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># para o dspp</span>
<span class="n">contrato_dspp_features</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">geral_and_comunicados_sorted_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;contrato_id&quot;</span><span class="p">])[</span><span class="s2">&quot;dspp&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">features</span><span class="o">.</span><span class="n">total_success_dspp15</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">total_success_dspp30</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">total_success_dspp45</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">prop_success_dspp15</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">prop_success_dspp30</span><span class="p">,</span>
            <span class="n">features</span><span class="o">.</span><span class="n">prop_success_dspp45</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># merging os dois sets de features criadas</span>
<span class="n">contrato_dsp_dspp</span> <span class="o">=</span> <span class="n">contrato_dsp_features</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">right</span><span class="o">=</span><span class="n">contrato_dspp_features</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;contrato_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span>
<span class="p">)</span>
</code></pre></div>
<p>Veja que, aqui temos não só o total de sucesso em cada um dos acionamentos, mas também uma proporção entre: <em>acionamentos_com_sucesso / total_de_acionamentos</em></p>
<p>Por fim, para juntar esses valores num <strong>score mais representativo</strong>, vamos calcular as médias das proporções, considerando os casos onde de fato o cliente recebeu acionamento.</p>
<div class="highlight"><pre><span></span><code><span class="n">means_dsp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">means_dspp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">contrato_dsp_dspp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">means_dsp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">13</span><span class="p">]))</span>
    <span class="n">means_dspp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">19</span><span class="p">]))</span>

<span class="n">contrato_dsp_dspp</span><span class="p">[</span><span class="s2">&quot;score_dsp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">means_dsp</span>
<span class="n">contrato_dsp_dspp</span><span class="p">[</span><span class="s2">&quot;score_dspp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">means_dspp</span>
</code></pre></div>
<h5 id="entregou-nao-entregou-leu">Entregou? Não Entregou? Leu?</h5>
<p>Aqui nós tivemos uma atualização, pois as features que antes computavam os acionamentos de não entregue, entregue, lido e recebido, não estão mais sendo utilizadas.</p>
<p>Ao invés disso, foi sumerizada a feature que computa a média para os diferentes tipos. Essas alterações também podem ser vistas no <code>final_composition_v2.ipynb</code>.</p>
<h5 id="valor-devedor-esperado">Valor devedor esperado</h5>
<p>Essa feature pode nos ajudar a entender se existe alguma relação entre o valor total de empréstimo do crédito com alguma outra feature que iremos trazer para compor a análise final. Como essa informação não estava explícita, resolvi considerar o valor devedor esperado no primeiro dia do contrato como valor de empréstimo daquele cliente.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># features de vlr_saldo_devedor</span>
<span class="n">vlr_saldo_devedor_inicial</span> <span class="o">=</span> <span class="n">geral_and_comunicados_sorted_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;contrato_id&quot;</span><span class="p">]</span>
<span class="p">)[[</span><span class="s2">&quot;contrato_id&quot;</span><span class="p">,</span> <span class="s2">&quot;vlr_saldo_devedor_esperado&quot;</span><span class="p">]]</span>

<span class="n">c_dsp_dspp_qtd_acoes_devedor</span> <span class="o">=</span> <span class="n">contrato_dsp_dspp_qtd_acoes</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">right</span><span class="o">=</span><span class="n">vlr_saldo_devedor_inicial</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;contrato_id&quot;</span>
<span class="p">)</span>
</code></pre></div>
<h5 id="trazendo-dados-cadastrais">Trazendo dados cadastrais</h5>
<p>Nossa tabela até o momento possui o <code>contrato_id</code> e algumas features que coletamos. Porém, para cruzar com os dados cadastrais dos clientes, vamos precisar também do <code>nr_documento</code>.</p>
<p>Para isso criamos uma tabela intermediária que vai nos ajudar a trazer os dados dos clientes para essa base.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># tabela intermediária</span>
<span class="n">x_contrato_id_nr_documento</span> <span class="o">=</span> <span class="n">geral_and_comunicados_sorted_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;contrato_id&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_documento&quot;</span><span class="p">]</span>
<span class="p">)[[</span><span class="s2">&quot;contrato_id&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_documento&quot;</span><span class="p">]]</span>

<span class="c1"># trazendo os nr_documentos</span>
<span class="n">c_dsp_dspp_qtd_acoes_devedor_w_doc</span> <span class="o">=</span> <span class="n">c_dsp_dspp_qtd_acoes_devedor</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">right</span><span class="o">=</span><span class="n">x_contrato_id_nr_documento</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;contrato_id&quot;</span>
<span class="p">)</span>

<span class="c1"># alguns nr_documentos estão duplicados por que o cliente</span>
<span class="c1"># pode ter mais de uma loja ou em diferentes regiões</span>
<span class="c1"># por isso estou agrupando os casos onde acontece duplicatas</span>
<span class="n">clientes_unique_nr_doc</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">clientes</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;nr_documento&quot;</span><span class="p">)[</span>
        <span class="p">[</span><span class="s2">&quot;tipo_empresa&quot;</span><span class="p">,</span> <span class="s2">&quot;cidade&quot;</span><span class="p">,</span> <span class="s2">&quot;estado&quot;</span><span class="p">,</span> <span class="s2">&quot;subsegmento&quot;</span><span class="p">,</span> <span class="s2">&quot;segmento&quot;</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># etapa final, de fato trazendo os dados dos clientes pra base</span>
<span class="n">c_dsp_dspp_qtd_acoes_devedor_w_doc_and_clients</span> <span class="o">=</span> <span class="n">c_dsp_dspp_qtd_acoes_devedor_w_doc</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">right</span><span class="o">=</span><span class="n">clientes_unique_nr_doc</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;nr_documento&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span>
<span class="p">)</span>
</code></pre></div>
<h5 id="tpv">+ TPV</h5>
<p>Agora, vamos trazer a informação do TPV, sumerizado por cliente. Aqui teremos:</p>
<ul>
<li>mínimo</li>
<li>máximo</li>
<li>média</li>
<li>mediana</li>
<li>soma</li>
</ul>
<p>Para <strong>quantidade de transação realizada no dia e para o valor do tpv.</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">qtd_trans_tpv</span> <span class="o">=</span> <span class="n">tpv</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;nr_documento&quot;</span><span class="p">)[[</span><span class="s2">&quot;qtd_transacoes&quot;</span><span class="p">,</span> <span class="s2">&quot;vlr_tpv&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">final_df</span> <span class="o">=</span> <span class="n">c_dsp_dspp_qtd_acoes_devedor_w_doc_and_clients</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">right</span><span class="o">=</span><span class="n">qtd_trans_tpv</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;nr_documento&quot;</span>
<span class="p">)</span>

<span class="c1"># saving our dataset</span>
<span class="n">final_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/to_analysis.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<h4 id="2-analise-exploratoria-dataset-final">2. Análise Exploratória (Dataset final)</h4>
<p>Agora, com nosso novo dataset, nós temos cerca de 41 features as quais podemos utilizar para chegar a conclusão de qual a melhor curva de acionamento do cliente.</p>
<p>Por questão de tempo e disponibilidade, irei focar em duas análises na tentativa de encontrar algum padrão que nos direcione para nosso objetivo. A primeira será uma análise do score_dsp e score_dspp com features de segmento e subsegmento, e em segundo, do score_dsp e score_dspp com features que indicam se as mensagens foram de fato entregues, lidas ou se simplesmente não foram entregues.</p>
<p>Vale pontuar aqui que esses scores foram calculado, tirando a média da porcentagem de sucesso ao aplicar uma campanha. E também que poderia muito bem cada uma dessas campanhas possuirem um peso específico, porém nesse primeiro momento vamos considerar todas as campanhas com o mesmo peso.</p>
<h5 id="dsp-e-dspp-pelo-segmento-e-subsegmento">DSP e DSPP pelo Segmento e Subsegmento</h5>
<p>Vamos iniciar filtrando o dados para retornar apenas os dados que vamos utilizar.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># intially by the dsp</span>
<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;nr_documento&quot;</span><span class="p">,</span> <span class="s2">&quot;score_dsp&quot;</span><span class="p">,</span> <span class="s2">&quot;segmento&quot;</span><span class="p">]][</span>
    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;segmento&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">segmentos</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;subsegmento&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">subsegmentos</span><span class="p">))</span>
<span class="p">]</span>
</code></pre></div>
<p>Aqui também estamos filtrando pelas categorias nos segmentos e subsegmentos, removendo os casos de <code>nr_documento</code> duplicado.</p>
<p>Vamos então analisar um boxplot para cada uma das categorias e ter uma visão de como estão distribuídos os scores.</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;segmento&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;score_dsp&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="boxplot-segmento" src="imgs/boxplot-segmentos.png" /></p>
<p>Com esse gráfico, podemos ver que existe uma variância alta nos dados, e independemente do segmento, existem valores que vão do 0 até o 1. Porém, ao olharmos para a mediana, vemos que <code>Serviços recorrentes</code> possuem os valores mais altos desse do <code>score_dsp</code>.</p>
<p>Agora, para o subsegmento:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># intially by the dsp</span>
<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;nr_documento&quot;</span><span class="p">,</span> <span class="s2">&quot;score_dsp&quot;</span><span class="p">,</span> <span class="s2">&quot;subsegmento&quot;</span><span class="p">]][</span>
    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;segmento&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">segmentos</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;subsegmento&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">subsegmentos</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;subsegmento&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;score_dsp&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="boxplot-subseg" src="imgs/boxplot-subseg.png" /></p>
<p>O mesmo comportamento do anteior pode ser visto aqui. Os valores de mediana mais altos estão por conta do subsegmento <code>Educação</code>. E setores relacionados a Alimentação, direta ou indiretamente, possuem valores em torno de 0.5 de mediana no <code>score_dsp</code>.</p>
<p>Vamos visualizar o mesmo para o dspp:</p>
<div class="highlight"><pre><span></span><code><span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;nr_documento&quot;</span><span class="p">,</span> <span class="s2">&quot;score_dspp&quot;</span><span class="p">,</span> <span class="s2">&quot;segmento&quot;</span><span class="p">,</span> <span class="s2">&quot;subsegmento&quot;</span><span class="p">]][</span>
    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;segmento&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">segmentos</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;subsegmento&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">subsegmentos</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;segmento&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;score_dspp&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;subsegmento&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;score_dspp&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="boxplot-subseg" src="imgs/dspp-boxplot.png" />
<img alt="boxplot-subseg" src="imgs/dspp-boxplot-sugseg.png" /></p>
<p>Pelo que vemos aqui, tanto para segmento, quanto para subsegmento, apesar de termos valores oscilando de 0 a 1 em todas as categorias, as medianas aqui são bem menores que no dsp.</p>
<p>Podemos inferir aqui que o score n consegue ser explicado apenas pelo segmento e subsegmento, sendo necessário mais variáveis, vamos seguir para a utilização das features de entrega do acionamento.</p>
<h4 id="3-clusterizacao">3. Clusterização</h4>
<p>Aqui foi preciso mudar a análise para uma clusterização, para que fosse possível identificar grupos e correlaciona-los com a melhor curva de acionamento ao cliente.</p>
<p>No notebook é possível encontrar todo o passo a passo do processo que foi realizado para o DSP e para o DSPP. Afim de simplificar o documento, estou trazendo aqui apenas os clusters obtidos:</p>
<blockquote>
<p>Clusters DSP</p>
</blockquote>
<p><img alt="clusters-dsp" src="imgs/clusters_dsp.png" /></p>
<blockquote>
<p>Clusters DSPP</p>
</blockquote>
<p><img alt="clusters-dspp" src="imgs/clusters_dspp.png" /></p>
<p>Com essa análise, foi possível obter grandes insights que corroboram com uma hipótese sobre a curva ideal.</p>
<h5 id="dsp">DSP</h5>
<p>Nos clusters do DSP, vimos que os clusters 2 e 3 possuem valores altos e próximos do score_dsp. Seguido do cluster 0 e em seguida do cluster 1.</p>
<p>Correlacionando isso a quantidade de sucesso nos acionamentos em cada um desses grupos, vimos que a melhor curva, tem um perfil da distribuição abaixo:</p>
<p>[img]</p>
<p>Ou seja, quando mais vezes esse cliente for acionado logo no início, mais chances teremos de sucesso. O que não acontece com clientes que são acionados ao longo de toda sua jornada.</p>
<h5 id="dspp">DSPP</h5>
<p>A mesma análise acima foi feita para o DSPP, onde chegamos as mesmas conclusões. Segue a curva ideal para o caso do DSPP.</p>
<p>[img]</p>
<h4 id="3-dashboarding">3. Dashboarding</h4>
<p>Após realizada a análise acima, cheguei a conclusão que a curva ideal de acionamento ao cliente é uma curva onde priorizamos ao máximo o acionamento logo no início da inadimplência.</p>
<p>Infelizmente não consegui trazer a melhor curva para grupos específicos, pois as features da clusterização que mais impactaram no problema estavam correlacionadas em relação ao total de sucesso de acionamento e não o segmento, cidade, estado ou outra feature cadastral.</p>
<p>Para melhorar essa análise, irei apresentar um dashboard com alguns filtros e visualizações sobre a mediana do sucesso em cada uma das campanhas, por cliente. Dessa forma conseguimos empoderar os usuários com dados e otimizar a tomada de decisão.</p>
<p>O que teremos de código dentro do dash será como o exibido abaixo:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># seleção de filtros</span>
<span class="n">filtro_estado</span> <span class="o">=</span> <span class="s2">&quot;SP&quot;</span>
<span class="n">filtro_cidade</span> <span class="o">=</span> <span class="s2">&quot;São Paulo&quot;</span>
<span class="n">prop_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;prop_&quot;</span><span class="p">)]</span>

<span class="c1"># aplicação dos filtros</span>
<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;estado&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">filtro_estado</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cidade&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">filtro_cidade</span><span class="p">)][</span><span class="n">prop_columns</span><span class="p">]</span>
<span class="n">df_melted</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">value_vars</span><span class="o">=</span><span class="n">prop_columns</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;props&quot;</span><span class="p">)</span>
<span class="n">to_plot</span> <span class="o">=</span> <span class="n">df_melted</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;props&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># transformando no tipo Categories, para ordenar o plot</span>
<span class="n">prop_categories</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;prop_success_dsp5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prop_success_dsp10&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prop_success_dsp15&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prop_success_dsp30&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prop_success_dsp60&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prop_success_dsp90&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prop_success_dspp15&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prop_success_dspp30&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prop_success_dspp45&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">to_plot</span><span class="p">[</span><span class="s2">&quot;props&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_plot</span><span class="p">[</span><span class="s2">&quot;props&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">prop_categories</span><span class="p">)</span>
<span class="n">to_plot_sorted</span> <span class="o">=</span> <span class="n">to_plot</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;props&quot;</span><span class="p">)</span>

<span class="c1"># plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">to_plot_sorted</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;props&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="img-barplot" src="imgs/barplot-median-props.png" /></p>
<p>A interpretação é que, para esse conjunto de clientes, filtrados para São Paulo e também cidade de São Paulo, tivemos uma conversão alta para o dsp5, e a mesma foi declinando até o dsp30. Já para o DSPP, tivemos uma conversão bem baixa, para os casos onde houve esse tipo de acionamento, chegando a 20%.</p>
<h3 id="conclusoes-e-insights">Conclusões e Insights</h3>
<p>Optei nesse projeto por uma abordagem mais simples, que consistiu uma análise descritiva seguido de uma sumerização dos dados e uma clusterização, levando em consideração cada um dos contratos e clientes presentes na base.</p>
<p>O objetivo foi de conseguir <strong>insights iniciais que possam nortear melhor a tomada de decisão</strong> sobre qual a melhor curva de acionamento do cliente.</p>
<p>Cheguei assim em um score de sucesso de cada um dos acionamentos direcionados ao cliente. Porém, esse score sozinho não é suficiente para obtermos a melhor curva de acionamento, e o mesmo precisa ser cruzado com outras features (<em>segunda etapa de análise do projeto</em>).</p>
<p>Ao final dessa segunda etapa, nosso dataset possuia 41 features, e isso foi inevitável dada a complexidade e nuances presentes no dados. Após a limpeza, a clusterização se mostrou bem útil para respondermos os problema.</p>
<p>Onde concluímos que <strong>a curva ideal de acionamento ao cliente é a curva que contém maior taxa de sucesso de acionamento principalmente no início da jornada</strong> de não pagamento da linha de crédito, o que foi comprovado a partir do estudo dos clusters.</p>
<p>Outro ponto importante é trazer para esse problema o conceito de <strong>experimentação</strong>, para possibilitar a utilização de <em>modelos de Uplift</em>, e assim saber de fato qual grupo de clientes devem ser abordados com os acionamentos.</p>
<p>Gostaria de finalizar agradecendo a oportunidade fornecida pela Stone em estar participando e aprendendo muito com esse desafio.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
      
        
        <a href="data_dict/" class="md-footer__link md-footer__link--next" aria-label="Next: Dicionário de Dados" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Dicionário de Dados
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": ["content.code.annotate"], "search": "assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.748e2769.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js"></script>
      
        <script src="javascripts/tablesort.js"></script>
      
    
  </body>
</html>